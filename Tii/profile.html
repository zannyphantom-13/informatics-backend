<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - The Informatics Initiative</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* --- 1. Global Reset & Base Styles --- */
        :root {
            --primary-color: #2a6e62;
            --secondary-color: #4a90e2;
            --text-color: #333;
            --background-color: #f4f6f8;
            --card-background: #ffffff;
            --border-color: #ddd;
            --error-color: #e74c3c;
        }
        /* --- 6. Profile Specific Styles --- */
        .profile-details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .profile-details-grid p {
            padding: 5px 0;
            border-bottom: 1px dashed var(--border-color);
        }

        .profile-details-grid strong {
            color: var(--primary-color);
            font-weight: 600;
        }
        .copyright-bar p {
            font-size: 0.9rem;
            color: #777;
        }
        
        .submit-btn {
            padding: 12px 25px;
            background-color: #5cb85c;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 700;
            transition: background-color 0.3s, transform 0.1s;
            display: inline-block;
            text-decoration: none;
        }

        .submit-btn:hover {
            background-color: #4cae4c;
            transform: translateY(-1px);
        }

        /* --- 8. Media Queries for Responsiveness --- */
            .profile-details-grid {
                grid-template-columns: 1fr;
            }
    </style>
</head>
<body class="login-body">
    <header>
        <a href="index.html">
        <div class="logo-container">
            <svg class="logo-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <polygon points="50,5 90,30 90,70 50,95 10,70 10,30" fill="transparent" stroke="#2a6e62" stroke-width="5"/>
                <circle cx="50" cy="50" r="10" fill="#2a6e62"/>
                <path d="M50 5 L50 95 M10 30 L90 70 M10 70 L90 30" stroke="#2a6e62" stroke-width="2"/>
            </svg>
            <h1>THE INFORMATICS INITIATIVE</h1>
        </div>
        </a>
        <nav class="main-nav">
            <a href="curriculum.html">Curriculum</a>
            <a href="lessons.html">Weekly Lessons</a>
            <a href="portal.html">Student Portal</a>
            <a href="feedback.html">Feedback</a>
        </nav>
        <a id="auth-button" href="login.html" class="login-btn">Logout</a>
    </header>

    <main class="login-main">
        <div class="login-container">
            <h3><i class="fas fa-user-circle"></i> My Student Profile</h3>
            
            <hr>
            
            <div class="profile-details-grid">
                <p><strong><i class="fas fa-id-badge"></i> Full Name:</strong> <span id="display_full_name"></span></p>
                <p><strong><i class="fas fa-envelope"></i> Email:</strong> <span id="display_email"></span></p>
                <p><strong><i class="fas fa-phone"></i> Phone:</strong> <span id="display_phone_number"></span></p>
                <p><strong><i class="fas fa-calendar-alt"></i> Date of Birth:</strong> <span id="display_dob"></span></p>
                <p><strong><i class="fas fa-globe-americas"></i> Country:</strong> <span id="display_country"></span></p>
            </div>
            
            <h4 style="margin-top: 25px;"><i class="fas fa-book-open"></i> Bio</h4>
            <div class="bio-box" style="border: 1px solid #ddd; padding: 15px; border-radius: 5px; background-color: #f9f9f9;">
                <p id="display_bio"></p>
            </div>
            
            <div style="margin-top: 30px; text-align: center;">
                <a href="change.html" class="submit-btn">
                    <i class="fas fa-edit"></i> Edit Profile Data
                </a>
            </div>
            
        </div>
    </main>

    <footer>
        <div class="copyright-bar">
            <div class="social-links">
                <a href="https://www.linkedin.com/company/informatics" target="_blank"><i class="fab fa-linkedin-in"></i></a>
                <a href="https://www.twitter.com/informatics" target="_blank"><i class="fab fa-twitter"></i></a>
                <a href="https://www.instagram.com/informatics" target="_blank"><i class="fab fa-instagram"></i></a>
                <a href="https://www.youtube.com/informatics" target="_blank"><i class="fab fa-youtube"></i></a>
                <a href="https://www.facebook.com/informatics" target="_blank"><i class="fab fa-facebook-f"></i></a>
                <a href="https://www.tiktok.com/@informatics" target="_blank"><i class="fab fa-tiktok"></i></a>
            </div>
            <p>&copy; 2024 The Informatics Initiative. All rights reserved.</p>
        </div>
    </footer>
     <script type="module">
    import { handleProfileFetch, handleAuthButton } from './auth.js';

    handleAuthButton();
    handleProfileFetch(); // Retrieves and sets the user's name
    </script>
    <script>
       // In your auth.js or profile.html script block

async function loadProfileData() {
    // 1. Retrieve the authentication token (assuming it's stored in localStorage)
    const token = localStorage.getItem('authToken'); 
    const profileError = document.getElementById('profile-error');

    if (!token) {
        // Handle case where user is not logged in
        if (profileError) profileError.textContent = "You must be logged in to view this page.";
        window.location.href = 'login.html'; // Redirect to login
        return;
    }

    try {
        // 2. Make a request to the server, including the token in the header
        const response = await fetch('/api/profile', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                // This is the crucial step: linking the request to the specific user via the token
                'Authorization': `Bearer ${token}` 
            }
        });

        if (!response.ok) {
            // Server responds with an error (e.g., 401 Unauthorized if token is invalid)
            throw new Error('Failed to load profile data.');
        }

        const userData = await response.json(); 
        
        // 3. Update the DOM elements with the received user data
        // NOTE: You must ensure these IDs exist in your profile.html!
        document.getElementById('display-full-name').textContent = userData.full_name;
        document.getElementById('display-email').textContent = userData.email;
        document.getElementById('display-country').textContent = userData.country;
        document.getElementById('display-bio').textContent = userData.bio || 'No bio provided.';
        
    } catch (error) {
        console.error("Error loading profile:", error);
        if (profileError) profileError.textContent = "Error loading user profile. Please try again.";
    }
}

// Call the function when the page loads (or within DOMContentLoaded)
loadProfileData();
    </script>
</body>
</html>